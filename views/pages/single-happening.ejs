<!DOCTYPE html>
<html>
 <%- include('../partials/head'); -%>

<body>
  <%- include('../partials/nav'); -%>
  <div class="full-story">
    <h2><%= happenings.title %></h2>
    <h3><%= happenings.first_hap %></h3>
    <div class="story-parts">
    <% haps.forEach(hap => {  %>
      <span><%= hap.body %></span>
    <% }) %>
    </div>
    <form id="single-create-form" method="POST" action="/hap">
      <input id="user_id_goes_here" type="hidden" name="user_id" />
      <input type="hidden" name="happenings_id" value="<%=happenings.id%>" />
      <input type="hidden" name="position" value="<%=haps.length + 1%>" />
      <input type="hidden" name="old_hap_id" value="<%=haps[haps.length-1].id%>"
      <h4>Add to the Story</h4>
      <textarea name="body" placeholder="And then, this happened..." required></textarea>
      <button>Add This!</button>
    </form>
    <form id="single-update-form" method="POST" action="/hap/<%=haps[haps.length -1].id%>">
      <input type="hidden" name="_method" value="PUT" />
      <input type="hidden" name="id_of_happening" value="<%=happenings.id%>" />
      <h4>Edit Your Last Contribution</h4>
      <textarea name="body"><%= haps[haps.length - 1].body %></textarea>
      <button>Update This!</button>
    </form>
    <form id="single-delete-form" method="POST" action="/happening/<%=happenings.id%>">
      <input type="hidden" name="_method" value="DELETE" />
      <h4>Delete Your Happening</h4>
      <button>Delete This!</button>
    </form>
  </div>
  <%- include('../partials/footer'); -%>
  <script>
    $('#user_id_goes_here').val(happeningId);
    if ('<%=happenings.user_id%>' === happeningId) {
      $('#single-create-form').hide();
      $('#single-update-form').hide();
      $('#single-delete-form').show();
    } else if (<%=happenings.is_finished%>) {
      $('#single-create-form').hide();
      $('#single-update-form').hide();
      $('#single-delete-form').hide();
    } else if ('<%=haps[haps.length -1].user_id%>' === happeningId) {
      $('#single-create-form').hide();
      $('#single-update-form').show();
      $('#single-delete-form').hide();
    } else {
      $('#single-create-form').show();
      $('#single-update-form').hide();
      $('#single-delete-form').hide();
    }
  </script>
</body>